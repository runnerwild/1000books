<!DOCTYPE html>
<html>
<head>
    <title>1000 books to read before you die</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
     <style>
        #books {
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
    #detailView {
    position: absolute; /* Allows for positioning anywhere */
    background-color: white;
    border: 1px solid black;
    width: 70%;
    padding: 10px;
    z-index: 100; /* Ensures it's above other content */
    display: none; /* Initially hidden */
    font-family: Arial, sans-serif;
    font-size: 14px;
}
 .dataTables_info,   .dataTables_filter, .dataTables_length, .dataTables_paginate, .paging_simple_numbers  {
            font-family: Arial, sans-serif;
        }

        }
    </style>
</head>
<body>
    <table id="books" class="display footer">
        <thead>
            <tr>
                <th>Image</th>
                <th>Title</th>
                <th>Author</th>
                <th>Genre</th>
                <th>Overall</th>
                <th>For</th>
                <th>Against</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
  <div id="detailView" ></div>
    <script>
    let jsonData;
    fetch('combined.json')
        .then(response => response.json())
        .then(data => {
             jsonData = data;
            let tableBody = '';
            data.forEach((item, index) =>  {
                tableBody += `<tr>
<td><button onclick="showDetails(${index})"><img width=100 src=${item.customAttributes.product.image}></button></td>
<td><a href="https://www.amazon.com/s?k=book for ${item.normalizedTitle}" target="_blank">${item.normalizedTitle}</a></td>
                    <td>${item.normalizedFirstAuthor}</td>
                    <td>${item.community.name}</td>
                    <td>${item.readCount - item.lifeShortCount}</td>
                    <td>${item.readCount}</td>
                    <td>${item.lifeShortCount}</td>
                </tr>`;
            });
            document.querySelector("#books tbody").innerHTML = tableBody;
        $('#books').DataTable({aLengthMenu: [ [ 50, 100, 200 ], [ 50, 100, 200] ]})
              .order( [ 4, 'desc' ] )
                      .draw();
            filter();
        });

    function filter(){
      var table = $('#books').DataTable();
       
          var select = $('<select />')
              .appendTo(
                  table.column(3).header()
              )
              .on( 'change', function () {
                 if ( this.value == 'all' ) {
                  table
                      .column(3)
                      .search( '' )
                  } else {
                  table
                      .column(3)
                      .search( $(this).val() )
            }
                  table
              .order( [ 4, 'desc' ] )
                      .draw();
              } );
       
          select.append( '<option value=all>All</option>') ;
          table
              .column(3)
              .cache( 'search' )
              .sort()
              .unique()
              .each( function ( d ) {
                  select.append( $('<option value="'+d+'">'+d+'</option>') );
              } );
    }
    document.getElementById('detailView').addEventListener('click', function() { this.style.display = 'none'; });
    function showDetails(index) {
      if($('#detailView:visible').length == 0) {
        const item = jsonData[index];
      let list = '';
      document.getElementById('detailView').innerHTML = '';
      item.earliestNotes.map(obj => obj.text).forEach((text) => {
        list += `<li>${text}</li>`
      })
      const detailView = document.getElementById('detailView')
      detailView.innerHTML = `<ul>${list}</ul>`;
      const scrollX = window.pageXOffset || document.documentElement.scrollLeft;
      const scrollY = window.pageYOffset || document.documentElement.scrollTop;

      detailView.style.left = (event.clientX + scrollX) + 'px';
      detailView.style.top = (event.clientY + scrollY) + 'px';
      detailView.style.display = 'block';
      } else {
        document.getElementById('detailView').style.display = 'none';
      }

    }
    </script>
</body>
</html>

